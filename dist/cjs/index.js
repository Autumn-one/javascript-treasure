"use strict";function e(e,t=null,i=null,r=!1){let o,n=e;return"number"==typeof t&&(r?(n=Promise.all([e,new Promise((e=>setTimeout(e,t)))]),o="all"):(n=Promise.allSettled([e,new Promise(((e,i)=>setTimeout(i,t)))]),o="allSettled")),"number"==typeof i&&(n=Promise.race([n,new Promise(((e,t)=>setTimeout((()=>t({type:"timeout",msg:"timeout error"})),i)))])),n.then((e=>"all"===o&&Array.isArray(e)?e[0]:"allSettled"===o&&Array.isArray(e)?e.find((e=>"fulfilled"===e.status))?.value:e))}function t(e,t=1e3){return"undefined"!=typeof requestIdleCallback?requestIdleCallback(e):setTimeout(e,t)}exports.async_idle=function(e=1e3){return new Promise((i=>{t(i,e)}))},exports.debounce=function(e,t,i="d",r){let o,n,u=0,l="timeout",s=!0;return"i-d"===i?function(...i){if(s)return s=!1,n=setTimeout((()=>s=!0),t),r&&r(),void e.apply(this,i);o&&clearTimeout(o),n&&clearTimeout(n),r&&r(),o=setTimeout((()=>{n=setTimeout((()=>s=!0),t),e.apply(this,i)}),t)}:"t-d"===i?function(...i){const n=+new Date;o&&clearTimeout(o);const s=n-u;if("immediate"!==l&&(s>=t||0==u))return u=n,l="immediate",r&&r(),void e.apply(this,i);"immediate"===l&&s>=t&&(r&&r(),o=setTimeout((()=>{u=n,l="timeout",e.apply(this,i)}),t))}:function(...i){o&&clearTimeout(o),r&&r(),o=setTimeout((()=>{e.apply(this,i)}),t)}},exports.idle=t,exports.promise_queue=async function(t,i=5e3){for(let o=0;o<t.length;o++){try{var r=await e(t[o],null,i)}catch(e){continue}return r}return Promise.reject("错误的 promise queue 调用")},exports.promise_timeout=e,exports.retry=async function(e,t){let i=0;const r=t?.times??1,o=t?.on_failed;for(;i<r;){try{var n=await e()}catch(e){i++,o?.(e,i);continue}break}return n},exports.throttle=function(e,t){let i=0;return function(...r){const o=+new Date;let n;"number"==typeof t?n=t:(n=t.time,r.push(t)),(o-i>=n||0===i)&&(e.apply(this,r),i=o)}};
