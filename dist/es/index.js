async function e(e,i=5e3){for(let r=0;r<e.length;r++){try{var n=await t(e[r],null,i)}catch(e){continue}return n}return Promise.reject("错误的 promise queue 调用")}function t(e,t=null,i=null,n=!1){let r,u=e;return"number"==typeof t&&(n?(u=Promise.all([e,new Promise((e=>setTimeout(e,t)))]),r="all"):(u=Promise.allSettled([e,new Promise(((e,i)=>setTimeout(i,t)))]),r="allSettled")),"number"==typeof i&&(u=Promise.race([u,new Promise(((e,t)=>setTimeout((()=>t({type:"timeout",msg:"timeout error"})),i)))])),u.then((e=>"all"===r&&Array.isArray(e)?e[0]:"allSettled"===r&&Array.isArray(e)?e.find((e=>"fulfilled"===e.status))?.value:e))}function i(e,t=1e3){return"undefined"!=typeof requestIdleCallback?requestIdleCallback(e):setTimeout(e,t)}function n(e=1e3){return new Promise((t=>{i(t,e)}))}function r(e,t,i="d",n){let r,u,o=0,l="timeout",a=!0;return"i-d"===i?function(...i){if(a)return a=!1,u=setTimeout((()=>a=!0),t),n&&n(),void e.apply(this,i);r&&clearTimeout(r),u&&clearTimeout(u),n&&n(),r=setTimeout((()=>{u=setTimeout((()=>a=!0),t),e.apply(this,i)}),t)}:"t-d"===i?function(...i){const u=+new Date;r&&clearTimeout(r);const a=u-o;if("immediate"!==l&&(a>=t||0==o))return o=u,l="immediate",n&&n(),void e.apply(this,i);"immediate"===l&&a>=t&&(n&&n(),r=setTimeout((()=>{o=u,l="timeout",e.apply(this,i)}),t))}:function(...i){r&&clearTimeout(r),n&&n(),r=setTimeout((()=>{e.apply(this,i)}),t)}}function u(e,t){let i=0;return function(...n){const r=+new Date;let u;"number"==typeof t?u=t:(u=t.time,n.push(t)),(r-i>=u||0===i)&&(e.apply(this,n),i=r)}}async function o(e,t){let i=0;const n=t?.times??1,r=t?.on_failed;for(;i<n;){try{var u=await e()}catch(e){i++,r?.(e,i);continue}break}return u}export{n as async_idle,r as debounce,i as idle,e as promise_queue,t as promise_timeout,o as retry,u as throttle};
