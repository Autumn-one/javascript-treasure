var test=function(e){"use strict";function t(e,t=null,i=null,r=!1){let n,u=e;return"number"==typeof t&&(r?(u=Promise.all([e,new Promise((e=>setTimeout(e,t)))]),n="all"):(u=Promise.allSettled([e,new Promise(((e,i)=>setTimeout(i,t)))]),n="allSettled")),"number"==typeof i&&(u=Promise.race([u,new Promise(((e,t)=>setTimeout((()=>t({type:"timeout",msg:"timeout error"})),i)))])),u.then((e=>"all"===n&&Array.isArray(e)?e[0]:"allSettled"===n&&Array.isArray(e)?e.find((e=>"fulfilled"===e.status))?.value:e))}function i(e,t=1e3){return"undefined"!=typeof requestIdleCallback?requestIdleCallback(e):setTimeout(e,t)}return e.async_idle=function(e=1e3){return new Promise((t=>{i(t,e)}))},e.debounce=function(e,t,i="d",r){let n,u,o=0,l="timeout",a=!0;return"i-d"===i?function(...i){if(a)return a=!1,u=setTimeout((()=>a=!0),t),r&&r(),void e.apply(this,i);n&&clearTimeout(n),u&&clearTimeout(u),r&&r(),n=setTimeout((()=>{u=setTimeout((()=>a=!0),t),e.apply(this,i)}),t)}:"t-d"===i?function(...i){const u=+new Date;n&&clearTimeout(n);const a=u-o;if("immediate"!==l&&(a>=t||0==o))return o=u,l="immediate",r&&r(),void e.apply(this,i);"immediate"===l&&a>=t&&(r&&r(),n=setTimeout((()=>{o=u,l="timeout",e.apply(this,i)}),t))}:function(...i){n&&clearTimeout(n),r&&r(),n=setTimeout((()=>{e.apply(this,i)}),t)}},e.idle=i,e.promise_queue=async function(e,i=5e3){for(let n=0;n<e.length;n++){try{var r=await t(e[n],null,i)}catch(e){continue}return r}return Promise.reject("错误的 promise queue 调用")},e.promise_timeout=t,e.retry=async function(e,t){let i=0;const r=t?.times??1,n=t?.on_failed;for(;i<r;){try{var u=await e()}catch(e){i++,n?.(e,i);continue}break}return u},e.throttle=function(e,t){let i=0;return function(...r){const n=+new Date;let u;"number"==typeof t?u=t:(u=t.time,r.push(t)),(n-i>=u||0===i)&&(e.apply(this,r),i=n)}},e}({});
